###################################################
### Turn on bedroom lights only if a family member
### is at home and turn on living room lights if
### anyone is at home after sunset.
### If nobody at home after sunset turn on the lights
### when we are close to home.
### Turn off the floor lamp at 9PM Sun-Thur (Wemo)
###################################################

  - alias: "Turn on living room lights after sunset"
    trigger:
      - platform: sun
        event: sunset
        offset: "-00:10:00"
    condition:
      - condition: state
        entity_id: group.family
        state: 'home'
    action:
      service: scene.turn_on
      entity_id: scene.living_room_night

  - alias: "Turn on bedroom lights after sunset"
    trigger:
      - platform: sun
        event: sunset
        offset: "-00:10:00"
    condition:
      - condition: state
        entity_id: group.family
        state: 'home'
    action:
      service: scene.turn_on
      entity_id: scene.bedroom_night

  - alias: "Turn on lights when arriving home at night"
    trigger:
      - platform: state
        entity_id: group.family
        from: 'not_home'
        to: 'home'
    condition:
      - condition: numeric_state
        entity_id: sun.sun
        value_template: '{{ state.attributes.elevation }}'
        below: 0
    action:
      service: scene.turn_on
      entity_id:
        - scene.living_room_night
        - scene.bedroom_night

  - alias: "Turn off Floor lamp at 9PM Sun-Thur"
    trigger:
      - platform: time
        at: '21:00:00'
    condition:
      condition: time
      weekday:
        - sun
        - mon
        - tue
        - wed
        - thu
    action:
      service: switch.turn_off
      entity_id: switch.living_room_lamp
